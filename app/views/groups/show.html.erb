<h1><%= @group.name%></h1>
<%= link_to 'Edit', edit_group_path(@group) if @is_admin %>
<% if @group.group_images.attached? %>
    <% @group.group_images.each do |image| %>
        <%= cl_image_tag image.key %>
        <%= link_to 'Delete' , delete_image_path(image_id: image.id), method: :delete, data: {confirm: 'Are you sure you want to delete this image?'} %>
    <% end %>
<% end %>

<h2>Current Members</h2><%= link_to 'Delete Group', group_path, method: :delete, data: {confirm: 'Are you sure you want to delete this group'} if @is_admin%>
<p>Suburb: <%= @group.location.suburb %></p>
<p>State: <%= @group.location.state %></p>
<p>Post Code: <%= @group.location.post_code%>
<% @group.approved_users.each do |user| %>
    <p><%= user.profile.full_name_to_csv if user.profile.present?%></p>
    <p><%= user.email if !user.profile.present?%>
    <p><%= link_to 'Delete', delete_member_path(group_id: @group.id, user_id: user.id), method: :delete, data: {confirm: 'Are you sure you want to delete this member?'} if @is_admin %></p>
    <p><%= link_to 'Make Admin', assign_admin_path(group_id: @group.id, user_id: user.id), method: :post, remote: true if !user.user_groups.where(user_id: user.id, group_id: @group.id).first.has_role? :group_admin %></p>
<% end %>
<% if @is_admin %>
    <%= form_with url: find_profile_path(id: @group.id), method: :get do |f| %>
        <%= f.label :suburb %>
        <%= f.text_field :suburb %>
        <%= f.label :post_code %>
        <%= f.number_field :post_code %>
        <%= f.label :state %>
        <%= f.text_field :state %>
        <%= f.submit 'Find a Player' %>
    <% end %>
<% end %>

<div>
<% case @is_admin %>
<% when true %>
<h1> Pending Requests</h1> 
<% @group.join_pending_users.each do |member| %>
    <p> You are an admin </p>
    <%= member.email %>
    <%= member.id %>
    <%= link_to 'Accept' , accept_request_path(user_id: member.id, group_id: params[:id]), method: :post, data: {confirm: 'Are you sure you want to accept this request?'} %>
    <%= link_to 'Delete', delete_member_path(group_id: params[:id], user_id: member.id), method: :delete, data: {confirm: 'Are you sure you want to reject this request?'} %>
<% end %>
<% end %>
</div>

<div>
  <h1> Games</h1>
    <%= link_to 'New Game', new_game_path if @is_admin %>
  <% @group.games.each do |game| %>
    <h3><%= game.name %></h3>
    <p>Time of Game:<%= game.time %></p>
    <p>Date of Event: <%= game.date %></p>
        <%= link_to 'Delete' , game_path(game.id), method: :delete if @is_admin %>
        <%= link_to 'Edit' , edit_game_path(game) if @is_admin %>
  <% end %>
</div>

<%= form_with model: @group, url: group_image_upload_path, method: :post do |f| %>
<%= f.file_field :group_images%>
<%= f.submit 'Add Image' %>
<% end %>
<% case @group.users.where('email = ?', "#{current_user.email}").exists? %>
<% when false %>
    <%= link_to 'Join',  user_groups_path(user_id: current_user.id, group_id: params[:id], approved: false, player_approval: true), method: :post %>
<% when true %>
<% end %>
