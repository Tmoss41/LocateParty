<div class="container">
    <div class="row align-items-start top_card">
      <div class="col">
          <div class='container-lg group_details_card'>
            <%= link_to 'Edit', edit_group_path(@group) if @is_admin %>
            <h1><%= @group.name%></h1>
            <p>Suburb: <%= @group.location.suburb %></p>
            <p>State: <%= @group.location.state %></p>
            <p>Post Code: <%= @group.location.post_code%>
          </div>
      </div>
      <div class="col">
        <div class='container-lg find_player_card'>
          <% if @is_admin %>
          <article>
            <%= form_with url: find_profile_path(id: @group.id), method: :get do |f| %>
              <div class='mb-3'>
                <%= f.label :suburb, class: 'form-label' %>
                <%= f.text_field :suburb, class: 'form-control' %>
              </div>
              <div class='mb-3'>
                <%= f.label :post_code, class: 'form-label' %>
                <%= f.number_field :post_code, class: 'form-control' %>
                </div>
              <div class='mb-3'>
                <%= f.label :state, class: 'form-label' %>
                <%= f.text_field :state, class: 'form-control' %>
                </div>
              
                <%= f.submit 'Find a Player', class: 'btn btn-dark' %>
            </article>
            <% end %>
            <% else %>
              <%= image_tag 'padlock.png', class: 'padlock' %>
        <% end %>
      </div>
      
    </div>
</div>
   <div class = "container-md members_card"> 
    <h1>Current Members </h1>
    <section>
    <div class="container">
  <div class="row align-items-start">
      <% @group.approved_users.each do |user| %>
              <div class="member_card">
                <p><%= user.profile.full_name_to_csv if user.profile.present?%></p>
                <p><%= user.email if !user.profile.present?%>
                <p><%= link_to 'Delete', delete_member_path(group_id: @group.id, user_id: user.id), method: :delete, data: {confirm: 'Are you sure you want to delete this member?'} if @is_admin %></p>
                <p><%= link_to 'Make Admin', assign_admin_path(group_id: @group.id, user_id: user.id), method: :post, remote: true if !user.user_groups.where(user_id: user.id, group_id: @group.id).first.has_role? :group_admin %></p>
              </div>
            <% end %>
    </div>
    </div>
      </section>
  </div>

<% case @is_admin %>
<% when true %>
<div class='container-md pending_card'>
    <h1> Pending Requests</h1> 
        <section>
        <div class='container'>
            <div class='row align-items-start'>
                <% @group.join_pending_users.each do |member| %>
                <div class='pending_card'>
                    <p> You are an admin </p>
                    <%= member.email %>
                    <%= member.id %>
                    <%= link_to 'Accept' , accept_request_path(user_id: member.id, group_id: params[:id]), method: :post, data: {confirm: 'Are you sure you want to accept this request?'} %>
                    <%= link_to 'Delete', delete_member_path(group_id: params[:id], user_id: member.id), method: :delete, data: {confirm: 'Are you sure you want to reject this request?'} %>
                </div>
                <% end %>
            </div>
        </div>
        </section>
<% end %>
</div>



<div class="container">
    <div class="row align-items-start top_card">
      <div class="col new_game_form_card">
      <% if @is_admin %>
      <h1> New Game</h1>
          <%= render 'game_form'%>
      </div>
      

      <div class="col games_card">
          <% if @is_admin %>
          <div class='container-lg'>
                <% @group.games.each do |game| %>
                    <div class="group_game_card">
                        <h3><%= game.name %></h3>
                        <p>Time of Game:<%= game.time %></p>
                        <p>Date of Event: <%= game.date %></p>
                        <%= link_to 'Delete' , game_path(game.id), method: :delete if @is_admin %>
                        <%= link_to 'Edit' , edit_game_path(game) if @is_admin %>
                    </div>
            <% end %>
          </div>
        <% end %>
        <% else %>
        <%= image_tag 'padlock.png', class: 'padlock_games' %>
        <% end %>
        </div>
      </div>
      
    </div>
</div>
<br>
<%= form_with model: @group, url: group_image_upload_path, method: :post, class: 'form_add_image' do |f| %>
<%= f.file_field :group_images%>
<%= f.submit 'Add Image' %>
<% end %>
<br>
<% case @group.users.where('email = ?', "#{current_user.email}").exists? %>
<% when false %>
    <%= link_to 'Join',  user_groups_path(user_id: current_user.id, group_id: params[:id], approved: false, player_approval: true), method: :post %>
<% when true %>
<% end %>

<% if @group.group_images.attached? %>
<div class='container-md image_display'>
    <% @group.group_images.each do |image| %>
      <div class='image_card'>
        <%= cl_image_tag image.key, crop: :scale, width: 300, cloud_name: 'tmoss41' %>
        <br>
        <%= link_to 'Delete' , delete_image_path(image_id: image.id), method: :delete, data: {confirm: 'Are you sure you want to delete this image?'} %>
      </div>
    <% end %>
  </div>
<% end %>